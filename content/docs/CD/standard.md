
## ğŸ§­ é€Ÿè§ˆ

- Canaryï¼šæ¸è¿›æ”¾é‡ï¼Œé€‚åˆæ ¸å¿ƒä¸šåŠ¡  
- Blue/Greenï¼šåŸå­åˆ‡æµï¼Œå›æ»šå¿«  
- Rollingï¼šé»˜è®¤ç­–ç•¥ï¼Œæˆæœ¬ä½  

## ğŸ§­ å‘å¸ƒç­–ç•¥é€‰å‹å»ºè®®

| åœºæ™¯ | æ¨èç­–ç•¥ |
|----|----|
| å†…éƒ¨ç³»ç»Ÿ | Recreate / Rolling |
| æ™®é€šä¸šåŠ¡ | Rolling |
| æ ¸å¿ƒç”Ÿäº§ç³»ç»Ÿ | Canary |
| é«˜å›æ»šè¦æ±‚ | Blue / Green |
| åŠŸèƒ½å®éªŒ | A/B |
| æ–°ç³»ç»ŸéªŒè¯ | Shadow |

---

## ğŸ§° äº‘åŸç”Ÿ CD æœ€ä½³å®è·µ

- æ„å»ºä¸å‘å¸ƒå®Œå…¨è§£è€¦
- å‘å¸ƒè¿‡ç¨‹å¿…é¡»å¯å›æ»š
- åŸºäºæŒ‡æ ‡å’Œ SLO é©±åŠ¨å‘å¸ƒå†³ç­–
- å‘å¸ƒè¿‡ç¨‹å…¨é“¾è·¯å¯è§‚æµ‹ï¼ˆMetric / Trace / Logï¼‰
- æ‰€æœ‰å‘å¸ƒè¡Œä¸ºå¯å®¡è®¡ã€å¯è¿½æº¯


## âš–ï¸ Canary ä¸ Blue/Green å‘å¸ƒæ–¹æ¡ˆå¯¹æ¯”

### 1. æ¦‚è¿°

Canaryï¼ˆç°åº¦å‘å¸ƒï¼‰ä¸ Blue/Greenï¼ˆè“ç»¿å‘å¸ƒï¼‰æ˜¯äº‘åŸç”Ÿåœºæ™¯ä¸­æœ€å¸¸è§çš„ä¸¤ç§å‘å¸ƒç­–ç•¥ã€‚
äºŒè€…éƒ½ç”¨äºé™ä½å‘å¸ƒé£é™©ï¼Œä½†åœ¨**æµé‡æ§åˆ¶æ–¹å¼ã€èµ„æºæ¨¡å‹ã€å›æ»šæœºåˆ¶**ç­‰æ–¹é¢å­˜åœ¨æœ¬è´¨å·®å¼‚ã€‚

---

### 2. æ ¸å¿ƒæ€æƒ³å¯¹æ¯”

| ç»´åº¦ | Canaryï¼ˆç°åº¦å‘å¸ƒï¼‰ | Blue/Greenï¼ˆè“ç»¿å‘å¸ƒï¼‰ |
|----|------------------|-----------------------|
| æ ¸å¿ƒæ€æƒ³ | å°æµé‡é€æ­¥éªŒè¯æ–°ç‰ˆæœ¬ | ä¸¤å¥—å®Œæ•´ç¯å¢ƒåŸå­åˆ‡æ¢ |
| å‘å¸ƒé£é™© | æ¸è¿›é™ä½ | åˆ‡æ¢ç¬é—´æ‰¿æ‹… |
| æµé‡æ¨¡å‹ | æŒ‰æ¯”ä¾‹åˆ†æµ | å…¨é‡åˆ‡æ¢ |
| éªŒè¯æ–¹å¼ | å®æ—¶è§‚æµ‹ç”Ÿäº§æµé‡ | é¢„è§ˆ + åˆ‡æµåéªŒè¯ |

---

### 3. æµé‡æ§åˆ¶æ–¹å¼

#### Canary

- åŒæ—¶è¿è¡Œæ–°æ—§ç‰ˆæœ¬
- æµé‡æŒ‰æ¯”ä¾‹é€æ­¥åˆ‡æ¢ï¼š
  - 10% â†’ 30% â†’ 50% â†’ 100%
- ä¾èµ–èƒ½åŠ›ï¼š
  - Argo Rollouts è‡ªèº«æƒé‡
  - Istio / NGINX / ALB ç­‰æµé‡ç½‘å…³

#### Blue/Green

- é€šè¿‡ Service selector å®ç°åˆ‡æ¢
- åˆ‡æµæ˜¯ **ä¸€æ¬¡æ€§åŸå­æ“ä½œ**
- ä¸æ”¯æŒæŒ‰æ¯”ä¾‹åˆ†æµ
- Preview æµé‡ä¸æ­£å¼æµé‡ä¸¥æ ¼éš”ç¦»

---

### 4. èµ„æºä½¿ç”¨å¯¹æ¯”

| ç»´åº¦ | Canary | Blue/Green |
|----|------|-----------|
| å‘å¸ƒæœŸé—´å‰¯æœ¬ | æ–°æ—§ç‰ˆæœ¬åŒæ—¶å­˜åœ¨ | æ–°æ—§ç‰ˆæœ¬å®Œæ•´è¿è¡Œ |
| å³°å€¼èµ„æºæ¶ˆè€— | è¾ƒä½ | è¾ƒé«˜ï¼ˆæ¥è¿‘ 2xï¼‰ |
| èµ„æºå¼¹æ€§è¦æ±‚ | ä¸­ | é«˜ |

---

### 5. å›æ»šæœºåˆ¶å¯¹æ¯”

#### Canary å›æ»š

- é€æ­¥å°†æµé‡æƒé‡é™ä¸º 0
- æ—§ç‰ˆæœ¬å§‹ç»ˆåœ¨çº¿
- å›æ»šé€Ÿåº¦å–å†³äºæµé‡è°ƒåº¦ç³»ç»Ÿ

#### Blue/Green å›æ»š

- ç›´æ¥åˆ‡æ¢ Service selector
- å›æ»šå‡ ä¹æ˜¯ç¬æ—¶å®Œæˆ
- ä¸ä¾èµ–æµé‡æƒé‡è®¡ç®—

---

### 6. å‘å¸ƒæ§åˆ¶èƒ½åŠ›

| èƒ½åŠ› | Canary | Blue/Green |
|----|------|-----------|
| æ‰‹åŠ¨æš‚åœ | æ”¯æŒ | æ”¯æŒ |
| è‡ªåŠ¨æ¨è¿› | æ”¯æŒ | æ”¯æŒ |
| æŒ‡æ ‡é©±åŠ¨å‘å¸ƒ | å¼º | ä¸­ |
| ç²¾ç»†æµé‡æ§åˆ¶ | å¼º | æ—  |

---

### 7. Analysisï¼ˆåˆ†æï¼‰èƒ½åŠ›

#### Canary

- æ¯ä¸ªé˜¶æ®µå¯é…ç½® Analysis
- æ”¯æŒï¼š
  - é”™è¯¯ç‡
  - å»¶è¿Ÿ
  - ä¸šåŠ¡æŒ‡æ ‡
- å¤±è´¥å¯è‡ªåŠ¨å›æ»š

#### Blue/Green

- æ”¯æŒ Pre-Promotion Analysis
- æ”¯æŒ Post-Promotion Analysis
- æ›´åå‘â€œå‘å¸ƒå‰ / å‘å¸ƒåâ€æ ¡éªŒ

---

### 8. æ•…éšœå½±å“èŒƒå›´

| ç»´åº¦ | Canary | Blue/Green |
|----|------|-----------|
| æ•…éšœæš´éœ²ç”¨æˆ· | å°èŒƒå›´ | å…¨é‡ |
| æ•…éšœå‘ç°é€Ÿåº¦ | å¿« | å–å†³äºç›‘æ§ |
| ç”¨æˆ·å½±å“æ§åˆ¶ | å¼º | å¼± |

---

### 9. è¿ç»´å¤æ‚åº¦

| ç»´åº¦ | Canary | Blue/Green |
|----|------|-----------|
| é…ç½®å¤æ‚åº¦ | é«˜ | ä½ |
| æµé‡ç³»ç»Ÿä¾èµ– | å¼º | å¼± |
| è¿ç»´å¿ƒæ™ºè´Ÿæ‹… | é«˜ | ä½ |

---

### 10. é€‚ç”¨åœºæ™¯å¯¹æ¯”

#### é€‚åˆ Canary çš„åœºæ™¯

- é«˜å¹¶å‘äº’è”ç½‘ä¸šåŠ¡
- éœ€è¦çœŸå®æµé‡éªŒè¯
- ä¸šåŠ¡æŒ‡æ ‡æ•æ„Ÿ
- å…è®¸é€æ­¥æ”¾é‡

#### é€‚åˆ Blue/Green çš„åœºæ™¯

- æ ¸å¿ƒç³»ç»Ÿ / é‡‘èç³»ç»Ÿ
- å›æ»šæ—¶é—´è¦æ±‚æé«˜
- ä¸å…è®¸æµé‡æ··è·‘
- å‘å¸ƒé¢‘ç‡ç›¸å¯¹è¾ƒä½

---

### 11. æ€»ç»“å¯¹æ¯”

| ç»´åº¦ | æ¨èæ–¹æ¡ˆ |
|----|--------|
| æè‡´ç¨³å®š & ç§’çº§å›æ»š | Blue/Green |
| é£é™©æœ€å°åŒ– & æ¸è¿›éªŒè¯ | Canary |
| èµ„æºå……è¶³ | Blue/Green |
| èµ„æºå—é™ | Canary |

---

### 12. é€‰å‹å»ºè®®

- **æ ¸å¿ƒé“¾è·¯**ï¼šBlue/Green
- **ç”¨æˆ·å…¥å£æœåŠ¡**ï¼šCanary
- **å¾®æœåŠ¡ä½“ç³»**ï¼šCanary + è‡ªåŠ¨ Analysis
- **åŸºç¡€å¹³å°ç»„ä»¶**ï¼šBlue/Green

---

### 13. ä¸€å¥è¯æ€»ç»“

> Canary æ˜¯â€œ**è¾¹è·‘è¾¹è¯•**â€ï¼Œ  
> Blue/Green æ˜¯â€œ**åˆ‡æ¢å¼€å…³**â€ã€‚

---

## ğŸ—ºï¸ Devflow Normalï¼ˆRollingï¼‰å‘å¸ƒæµç¨‹å›¾ï¼ˆç¤ºä¾‹ï¼‰

```mermaid
flowchart LR
    A[Devflow Console] --> B[Devflow Job]
    B --> C[Argo CD Application]
    C --> D[Kubernetes Deployment]

    C -. watch .-> F[Devflow Controller]
    D -. watch .-> F
    F --> M[(MongoDB)]
    M -->|æ›´æ–° steps / job status| F

    D --> S0
    subgraph Rolling Steps
        S0[Applied] --> S1[Rolling Update]
        S1 --> S2[Verify]
        S2 --> S3[Completed]
    end
```

è¯´æ˜ï¼š

- å‘å¸ƒé“¾è·¯ï¼šDevflow Console è§¦å‘ Jobï¼Œç”Ÿæˆ Argo CD Applicationï¼Œä¸‹å‘åˆ° Kubernetes Deploymentã€‚
- æ§åˆ¶é—­ç¯ï¼šDevflow Controller ç›‘å¬ Application ä¸ Deployment çŠ¶æ€ï¼Œå›å†™ Mongo çš„ `steps` ä¸ `job status`ã€‚
- Normal èŠ‚å¥ï¼šDeployment å®Œæˆ Rolling Update åè¿›å…¥ Completedã€‚
