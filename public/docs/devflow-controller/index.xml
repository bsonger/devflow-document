<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>devflow-controller on Devflow</title>
    <link>http://localhost:1313/docs/devflow-controller/</link>
    <description>Recent content in devflow-controller on Devflow</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <atom:link href="http://localhost:1313/docs/devflow-controller/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title></title>
      <link>http://localhost:1313/docs/devflow-controller/canary/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/docs/devflow-controller/canary/</guid>
      <description>&lt;h1 id=&#34;devflow-controller-监听cd-与状态回写流程&#34;&gt;Devflow Controller 监听CD 与状态回写流程&lt;a class=&#34;anchor&#34; href=&#34;#devflow-controller-%e7%9b%91%e5%90%accd-%e4%b8%8e%e7%8a%b6%e6%80%81%e5%9b%9e%e5%86%99%e6%b5%81%e7%a8%8b&#34;&gt;#&lt;/a&gt;&lt;/h1&gt;&#xA;&lt;p&gt;Devflow Controller 的核心职责是 &lt;strong&gt;监听 Argo CD Application 与 Argo Rollouts Rollout 的状态变化&lt;/strong&gt;，并将发布进度与结果回写到 Mongo（&lt;code&gt;steps&lt;/code&gt; 与 &lt;code&gt;job status&lt;/code&gt;），形成闭环可观测的发布流水线。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;1-监听对象&#34;&gt;1. 监听对象&lt;a class=&#34;anchor&#34; href=&#34;#1-%e7%9b%91%e5%90%ac%e5%af%b9%e8%b1%a1&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;Argo CD Application&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;用于确认配置是否已下发（同步状态）&lt;/li&gt;&#xA;&lt;li&gt;用于确认应用健康状态（健康度）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Argo Rollouts Rollout&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;用于跟踪灰度阶段、流量权重与暂停/校验&lt;/li&gt;&#xA;&lt;li&gt;用于判断发布是否成功、失败或回滚&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;2-回写数据结构mongo&#34;&gt;2. 回写数据结构（Mongo）&lt;a class=&#34;anchor&#34; href=&#34;#2-%e5%9b%9e%e5%86%99%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84mongo&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;steps&lt;/strong&gt;：记录每个灰度阶段的执行进度与校验结果&#xA;&lt;ul&gt;&#xA;&lt;li&gt;例如：Applied / 10% / Verify / 30% / Verify / 50% / Verify / 100%&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;job status&lt;/strong&gt;：记录整个发布任务的全局状态&#xA;&lt;ul&gt;&#xA;&lt;li&gt;例如：Running / Succeeded / Failed&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;3-典型监听与回写流程canary&#34;&gt;3. 典型监听与回写流程（Canary）&lt;a class=&#34;anchor&#34; href=&#34;#3-%e5%85%b8%e5%9e%8b%e7%9b%91%e5%90%ac%e4%b8%8e%e5%9b%9e%e5%86%99%e6%b5%81%e7%a8%8bcanary&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;创建发布任务&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Devflow Console 触发 Job&lt;/li&gt;&#xA;&lt;li&gt;生成 Argo CD Application&lt;/li&gt;&#xA;&lt;li&gt;Controller 监听到 Application 已同步 → &lt;code&gt;steps=Applied&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;下发 Rollout&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Rollout 资源创建&lt;/li&gt;&#xA;&lt;li&gt;Controller 监听 Rollout 进入发布阶段 → &lt;code&gt;job status=Running&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;按阶段推进&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;10% → Verify → 30% → Verify → 50% → Verify → 100%&lt;/li&gt;&#xA;&lt;li&gt;Controller 在每个阶段更新 &lt;code&gt;steps&lt;/code&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;进入阶段：标记为 Running&lt;/li&gt;&#xA;&lt;li&gt;验证通过：标记为 Succeeded&lt;/li&gt;&#xA;&lt;li&gt;验证失败：标记为 Failed，并更新 &lt;code&gt;job status=Failed&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;发布完成&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Rollout 进入完成状态&lt;/li&gt;&#xA;&lt;li&gt;Controller 更新 &lt;code&gt;steps=100%&lt;/code&gt;，并设置 &lt;code&gt;job status=Succeeded&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;4-状态映射建议简化版&#34;&gt;4. 状态映射建议（简化版）&lt;a class=&#34;anchor&#34; href=&#34;#4-%e7%8a%b6%e6%80%81%e6%98%a0%e5%b0%84%e5%bb%ba%e8%ae%ae%e7%ae%80%e5%8c%96%e7%89%88&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;监听对象&lt;/th&gt;&#xA;          &lt;th&gt;关键状态&lt;/th&gt;&#xA;          &lt;th&gt;steps 更新&lt;/th&gt;&#xA;          &lt;th&gt;job status 更新&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;Application&lt;/td&gt;&#xA;          &lt;td&gt;Synced / Healthy&lt;/td&gt;&#xA;          &lt;td&gt;Applied&lt;/td&gt;&#xA;          &lt;td&gt;Running&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;Rollout&lt;/td&gt;&#xA;          &lt;td&gt;Progressing / Paused&lt;/td&gt;&#xA;          &lt;td&gt;对应阶段 Running&lt;/td&gt;&#xA;          &lt;td&gt;Running&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;Rollout&lt;/td&gt;&#xA;          &lt;td&gt;Analysis 成功&lt;/td&gt;&#xA;          &lt;td&gt;对应 Verify Succeeded&lt;/td&gt;&#xA;          &lt;td&gt;Running&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;Rollout&lt;/td&gt;&#xA;          &lt;td&gt;Degraded / Analysis 失败&lt;/td&gt;&#xA;          &lt;td&gt;对应 Verify Failed&lt;/td&gt;&#xA;          &lt;td&gt;Failed&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;Rollout&lt;/td&gt;&#xA;          &lt;td&gt;Completed&lt;/td&gt;&#xA;          &lt;td&gt;100% Succeeded&lt;/td&gt;&#xA;          &lt;td&gt;Succeeded&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;5-异常与回滚&#34;&gt;5. 异常与回滚&lt;a class=&#34;anchor&#34; href=&#34;#5-%e5%bc%82%e5%b8%b8%e4%b8%8e%e5%9b%9e%e6%bb%9a&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;如果 Rollout 进入 &lt;strong&gt;Degraded&lt;/strong&gt; 或 Analysis 失败：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Controller 立即回写 &lt;code&gt;steps=Failed&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;更新 &lt;code&gt;job status=Failed&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Rollout 侧可自动回滚（由策略或人工决定）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 id=&#34;6-关键点总结&#34;&gt;6. 关键点总结&lt;a class=&#34;anchor&#34; href=&#34;#6-%e5%85%b3%e9%94%ae%e7%82%b9%e6%80%bb%e7%bb%93&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Application 保证 &lt;strong&gt;配置已下发&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;Rollout 体现 &lt;strong&gt;发布过程与流量进度&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;Controller 负责 &lt;strong&gt;监听 + 归一化状态 + 回写 Mongo&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;steps&lt;/code&gt; 精细化记录阶段；&lt;code&gt;job status&lt;/code&gt; 表示全局结果&lt;/li&gt;&#xA;&lt;/ul&gt;</description>
    </item>
  </channel>
</rss>
